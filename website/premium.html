<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Flute Music Premium</title>
<link rel="stylesheet" href="style.css">
<style>
:root {
  --bg: #0b1220;
  --panel: #111827;
  --gold: #f6c945;
  --text: #f9fafb;
  --muted: #b6becd;
}

* { box-sizing: border-box; }

body {
  background: radial-gradient(1200px 700px at 10% -10%, #1b2a4d, var(--bg));
  color: var(--text);
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
}

.premium-container {
  max-width: 1040px;
  margin: 0 auto;
  padding: 56px 18px 72px;
  text-align: center;
}

.premium-title {
  font-size: clamp(2rem, 4vw, 3rem);
  color: var(--gold);
  margin: 0 0 8px;
}

.subtext {
  color: var(--muted);
  margin-bottom: 36px;
}

.cards {
  display: flex;
  gap: 22px;
  justify-content: center;
  flex-wrap: wrap;
}

.card {
  background: linear-gradient(180deg, #1a2440, var(--panel));
  padding: 24px;
  border-radius: 14px;
  width: 300px;
  border: 1px solid rgba(246, 201, 69, 0.35);
  box-shadow: 0 16px 32px rgba(0, 0, 0, 0.25);
  text-align: left;
}

.card h3 {
  color: var(--gold);
  margin: 0 0 6px;
  font-size: 1.35rem;
}

.price {
  font-size: 1.7rem;
  font-weight: 700;
  margin: 8px 0 14px;
}

.list {
  margin: 0;
  padding-left: 18px;
  color: var(--muted);
  min-height: 92px;
}

.buy-btn {
  margin-top: 20px;
  width: 100%;
  padding: 12px 16px;
  background: var(--gold);
  border: none;
  border-radius: 8px;
  font-size: 0.95rem;
  cursor: pointer;
  font-weight: 700;
  color: #1a1a1a;
  transition: transform 0.2s ease, filter 0.2s ease;
}

.buy-btn:hover {
  transform: translateY(-2px);
  filter: brightness(1.05);
}

.back-link {
  display: inline-block;
  margin-top: 32px;
  color: var(--muted);
  text-decoration: none;
}

.back-link:hover {
  color: var(--text);
}
</style>
</head>

<body>
<div class="premium-container">
  <h1 class="premium-title">Flute Music Premium</h1>
  <p class="subtext">Weekly and monthly subscriptions with instant Discord activation.</p>

  <div class="cards">
    <div class="card">
      <h3>Weekly</h3>
      <p class="price">INR 99</p>
      <ul class="list">
        <li>7 days premium access</li>
        <li>All filters and effects</li>
        <li>Priority support</li>
      </ul>
      <button class="buy-btn" onclick="startPayment('weekly')">Buy Weekly Plan</button>
    </div>

    <div class="card">
      <h3>Monthly</h3>
      <p class="price">INR 299</p>
      <ul class="list">
        <li>30 days premium access</li>
        <li>All filters and effects</li>
        <li>Best value for regular users</li>
      </ul>
      <button class="buy-btn" onclick="startPayment('monthly')">Buy Monthly Plan</button>
    </div>

    <div class="card">
      <h3>Lifetime</h3>
      <p class="price">INR 999</p>
      <ul class="list">
        <li>One-time payment</li>
        <li>Never expires</li>
        <li>All future premium updates</li>
      </ul>
      <button class="buy-btn" onclick="startPayment('lifetime')">Buy Lifetime Plan</button>
    </div>
  </div>

  <a class="back-link" href="index.html">Back to Home</a>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
const plans = {
  weekly: { amount: 9900, description: "7 days of premium features" },
  monthly: { amount: 29900, description: "30 days of premium features" },
  lifetime: { amount: 99900, description: "Lifetime premium access" }
};

const discordIdPattern = /^\d{15,22}$/;

async function startPayment(plan) {
  const userId = prompt("Enter your Discord user ID (for premium activation)");
  if (!userId) {
    alert("Discord ID is required.");
    return;
  }

  if (!discordIdPattern.test(userId.trim())) {
    alert("Enter a valid Discord user ID.");
    return;
  }

  const userEmail = prompt("Enter your email (optional)") || "";

  try {
    const res = await fetch("/api/create-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ plan, userEmail, userId: userId.trim() })
    });

    const data = await res.json();
    if (!data.success) {
      throw new Error(data.error || "Order creation failed");
    }

    const options = {
      key: data.key,
      amount: data.amount,
      currency: data.currency,
      name: "Flute Music Premium",
      description: plans[plan].description,
      order_id: data.orderId,
      prefill: { email: userEmail },
      notes: { plan, userId: userId.trim() },
      handler: async function (response) {
        try {
          const verifyRes = await fetch("/api/verify-payment", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(response)
          });

          const verifyData = await verifyRes.json();
          if (!verifyData.success) {
            throw new Error(verifyData.error || "Verification failed");
          }

          alert("Payment successful. Premium is now active on your Discord account.");
        } catch (verifyError) {
          alert("Payment captured, but verification failed: " + verifyError.message);
        }
      }
    };

    const rzp = new Razorpay(options);
    rzp.open();
  } catch (error) {
    console.error(error);
    alert("Unable to start payment: " + error.message);
  }
}
</script>
</body>
</html>
